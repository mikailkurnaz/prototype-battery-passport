const passports = [
  { id: "NMC-BAT-2025-FR-8105", path: "./passport/nmc-bat-2025-fr-8105.json" }
];

const elSelect = document.getElementById("passportSelect");
const elSummary = document.getElementById("summary");
const elRaw = document.getElementById("raw");
const elStatus = document.getElementById("statusPill");

for (const p of passports) {
  const opt = document.createElement("option");
  opt.value = p.path;
  opt.textContent = p.id;
  elSelect.appendChild(opt);
}

elSelect.addEventListener("change", () => load(elSelect.value));

load(passports[0].path);

function pillText(status) {
  if (status === "production") return "Production";
  return "Prototype / Demo";
}

async function load(path) {
  const res = await fetch(path, { cache: "no-store" });
  const data = await res.json();

  elStatus.textContent = pillText(data.passport?.status);

  const rows = [
    ["Pasaport ID", data.passport?.id],
    ["Versiyon", data.passport?.version],
    ["Batarya Türü", data.battery?.batteryType],
    ["Model", data.battery?.model],
    ["Kimya", data.battery?.chemistry?.label],
    ["Üretim (Yıl)", data.battery?.manufacturing?.year],
    ["Üretim (Ülke)", data.battery?.manufacturing?.country],
    ["Karbon Ayak İzi", data.carbonFootprint?.total ? `${data.carbonFootprint.total.value} ${data.carbonFootprint.total.unit}` : "—"]
  ];

  elSummary.innerHTML = rows.map(([k, v]) => `
    <div class="row">
      <div class="k">${escapeHtml(k)}</div>
      <div class="v">${escapeHtml(v ?? "—")}</div>
    </div>
  `).join("");

  elRaw.textContent = JSON.stringify(data, null, 2);
}

function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, (c) => ({
    "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
  }[c]));
}
